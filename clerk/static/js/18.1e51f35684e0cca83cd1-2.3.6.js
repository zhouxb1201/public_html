webpackJsonp([18],{"7ntd":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a("bOdI"),i=a.n(n),s=(a("nsZj"),a("kXkE"),a("WPoX")),r=a("o69Z"),o=Object(r.j)("uploader"),c=o[0],u=o[1],d=c({inheritAttrs:!1,props:{disabled:Boolean,beforeRead:Function,afterRead:Function,accept:{type:String,default:"image/*"},resultType:{type:String,default:"dataUrl"},maxSize:{type:Number,default:Number.MAX_VALUE}},computed:{detail:function(){return{name:this.$attrs.name||""}}},methods:{onChange:function(t){var e=this,a=t.target.files;!this.disabled&&a.length&&(!(a=1===a.length?a[0]:[].slice.call(a,0))||this.beforeRead&&!this.beforeRead(a,this.detail)?this.resetInput():Array.isArray(a)?Promise.all(a.map(this.readFile)).then(function(t){var n=!1,i=a.map(function(i,s){return i.size>e.maxSize&&(n=!0),{file:a[s],content:t[s]}});e.onAfterRead(i,n)}):this.readFile(a).then(function(t){e.onAfterRead({file:a,content:t},a.size>e.maxSize)}))},readFile:function(t){var e=this;return new Promise(function(a){var n=new FileReader;n.onload=function(t){a(t.target.result)},"dataUrl"===e.resultType?n.readAsDataURL(t):"text"===e.resultType&&n.readAsText(t)})},onAfterRead:function(t,e){e?this.$emit("oversize",t):this.afterRead&&this.afterRead(t,this.detail),this.resetInput()},resetInput:function(){this.$refs.input&&(this.$refs.input.value="")}},render:function(t){var e=this.accept,a=this.disabled;return t("div",{class:u()},[this.slots(),t("input",{attrs:Object(s.a)({},this.$attrs,{type:"file",accept:e,disabled:a}),ref:"input",class:u("input"),on:{change:this.onChange}})])}}),l={name:"account-avatar",data:function(){return{}},computed:{imgHeight:function(){return document.body.offsetWidth-30+"px"},avatar:{get:function(){return this.$store.getters.avatar?this.$store.getters.avatar:""},set:function(t){console.log(t)}}},created:function(){var t=this;this.$store.dispatch("getAccountInfo").then(function(){t.$refs.load.success()}).catch(function(){t.$refs.load.fail()})},methods:{onRead:function(t){var e=t.file,a=this;if(e.size/1024>1024)a.$Toast(e.name+"图片大小不能超过1M");else{var n=new FormData;n.append("file",e),a.$Toast.loading({message:"上传中...",duration:0,forbidClick:!0,loadingType:"circular"}),a.$store.dispatch("uploadImages",n).then(function(t){a.$Toast.clear(),a.$Toast.success("上传成功！")}).catch(function(t){a.$Toast.clear(),console.log(t),a.$Toast.fail("上传失败！")})}}},components:i()({},d.name,d)},f={render:function(){var t=this.$createElement,e=this._self._c||t;return e("Layout",{ref:"load",staticClass:"account-avatar bg-f8"},[e("Navbar",{attrs:{isMenu:!1}}),this._v(" "),e("div",[e("div",{staticClass:"box"},[e("div",{staticClass:"img",style:"maxHeight:"+this.imgHeight},[e("img",{attrs:{src:this.avatar,onerror:this.$ERRORPIC.noAvatar}})]),this._v(" "),e("div",{staticClass:"fixed-foot-btn-group"},[e("van-uploader",{staticClass:"btn-upload",attrs:{"after-read":this.onRead,accept:"image/png, image/jpeg"}},[e("van-button",{attrs:{size:"normal",type:"danger",round:"",block:""}},[this._v("上传头像")])],1)],1)])])],1)},staticRenderFns:[]};var h=a("VU/8")(l,f,!1,function(t){a("YSbM")},"data-v-746c3850",null);e.default=h.exports},YSbM:function(t,e){},kXkE:function(t,e){}});