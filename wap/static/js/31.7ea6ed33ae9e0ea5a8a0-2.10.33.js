webpackJsonp([31],{"9Yn1":function(t,e){},Jb41:function(t,e){},SldL:function(t,e){!function(e){"use strict";var n,r=Object.prototype,i=r.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},s=a.iterator||"@@iterator",o=a.asyncIterator||"@@asyncIterator",c=a.toStringTag||"@@toStringTag",l="object"==typeof t,u=e.regeneratorRuntime;if(u)l&&(t.exports=u);else{(u=e.regeneratorRuntime=l?t.exports:{}).wrap=x;var h="suspendedStart",d="suspendedYield",v="executing",f="completed",p={},m={};m[s]=function(){return this};var _=Object.getPrototypeOf,y=_&&_(_(T([])));y&&y!==r&&i.call(y,s)&&(m=y);var g=E.prototype=C.prototype=Object.create(m);b.prototype=g.constructor=E,E.constructor=b,E[c]=b.displayName="GeneratorFunction",u.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===b||"GeneratorFunction"===(e.displayName||e.name))},u.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,E):(t.__proto__=E,c in t||(t[c]="GeneratorFunction")),t.prototype=Object.create(g),t},u.awrap=function(t){return{__await:t}},z(S.prototype),S.prototype[o]=function(){return this},u.AsyncIterator=S,u.async=function(t,e,n,r){var i=new S(x(t,e,n,r));return u.isGeneratorFunction(e)?i:i.next().then(function(t){return t.done?t.value:i.next()})},z(g),g[c]="Generator",g[s]=function(){return this},g.toString=function(){return"[object Generator]"},u.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},u.values=T,H.prototype={constructor:H,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach($),!t)for(var e in this)"t"===e.charAt(0)&&i.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=n)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(r,i){return o.type="throw",o.arg=t,e.next=r,i&&(e.method="next",e.arg=n),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var s=this.tryEntries[a],o=s.completion;if("root"===s.tryLoc)return r("end");if(s.tryLoc<=this.prev){var c=i.call(s,"catchLoc"),l=i.call(s,"finallyLoc");if(c&&l){if(this.prev<s.catchLoc)return r(s.catchLoc,!0);if(this.prev<s.finallyLoc)return r(s.finallyLoc)}else if(c){if(this.prev<s.catchLoc)return r(s.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return r(s.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var s=a?a.completion:{};return s.type=t,s.arg=e,a?(this.method="next",this.next=a.finallyLoc,p):this.complete(s)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),p},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),$(n),p}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;$(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:T(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=n),p}}}function x(t,e,n,r){var i=e&&e.prototype instanceof C?e:C,a=Object.create(i.prototype),s=new H(r||[]);return a._invoke=function(t,e,n){var r=h;return function(i,a){if(r===v)throw new Error("Generator is already running");if(r===f){if("throw"===i)throw a;return k()}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var o=L(s,n);if(o){if(o===p)continue;return o}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===h)throw r=f,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=v;var c=w(t,e,n);if("normal"===c.type){if(r=n.done?f:d,c.arg===p)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r=f,n.method="throw",n.arg=c.arg)}}}(t,n,s),a}function w(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}function C(){}function b(){}function E(){}function z(t){["next","throw","return"].forEach(function(e){t[e]=function(t){return this._invoke(e,t)}})}function S(t){var e;this._invoke=function(n,r){function a(){return new Promise(function(e,a){!function e(n,r,a,s){var o=w(t[n],t,r);if("throw"!==o.type){var c=o.arg,l=c.value;return l&&"object"==typeof l&&i.call(l,"__await")?Promise.resolve(l.__await).then(function(t){e("next",t,a,s)},function(t){e("throw",t,a,s)}):Promise.resolve(l).then(function(t){c.value=t,a(c)},s)}s(o.arg)}(n,r,e,a)})}return e=e?e.then(a,a):a()}}function L(t,e){var r=t.iterator[e.method];if(r===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=n,L(t,e),"throw"===e.method))return p;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var i=w(r,t.iterator,e.arg);if("throw"===i.type)return e.method="throw",e.arg=i.arg,e.delegate=null,p;var a=i.arg;return a?a.done?(e[t.resultName]=a.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=n),e.delegate=null,p):a:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,p)}function P(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function $(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function H(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(P,this),this.reset(!0)}function T(t){if(t){var e=t[s];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,a=function e(){for(;++r<t.length;)if(i.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=n,e.done=!0,e};return a.next=a}}return{next:k}}function k(){return{value:n,done:!0}}}(function(){return this}()||Function("return this")())},Xxa5:function(t,e,n){t.exports=n("jyFz")},exGp:function(t,e,n){"use strict";e.__esModule=!0;var r,i=n("//Fk"),a=(r=i)&&r.__esModule?r:{default:r};e.default=function(t){return function(){var e=t.apply(this,arguments);return new a.default(function(t,n){return function r(i,s){try{var o=e[i](s),c=o.value}catch(t){return void n(t)}if(!o.done)return a.default.resolve(c).then(function(t){r("next",t)},function(t){r("throw",t)});t(c)}("next")})}}},jyFz:function(t,e,n){var r=function(){return this}()||Function("return this")(),i=r.regeneratorRuntime&&Object.getOwnPropertyNames(r).indexOf("regeneratorRuntime")>=0,a=i&&r.regeneratorRuntime;if(r.regeneratorRuntime=void 0,t.exports=n("SldL"),i)r.regeneratorRuntime=a;else try{delete r.regeneratorRuntime}catch(t){r.regeneratorRuntime=void 0}},"r+4c":function(t,e){},s0qp:function(t,e){},vdpN:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n("Xxa5"),i=n.n(r),a=n("exGp"),s=n.n(a),o=n("eKM9"),c=n("QmeG"),l=n("vLgD");var u={props:{isShow:{type:Boolean,default:!1},id:[Number,String]},data:function(){return{info:{}}},watch:{isShow:function(t){document.querySelector("html").style.overflow=!0===t?"hidden":""}},mounted:function(){var t,e=this;(t=this.id,Object(l.a)({url:"/addons/scratchcard/scratchcard/scratchcardInfo",method:"post",data:{scratch_card_id:t}})).then(function(t){var n=t.data;e.info=n})},methods:{close:function(){this.$emit("close")}}},h={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.isShow?n("div",{staticClass:"popup"},[n("div",{staticClass:"popup-explain-wrap"},[n("div",{staticClass:"explain-content"},[n("div",{staticClass:"prize-title"},[n("img",{attrs:{src:t.$BASEIMGPATH+"prize_title.png"}}),t._v(" "),n("span",[t._v("活动奖品")])]),t._v(" "),n("div",{staticClass:"prize-table"},[t._m(0),t._v(" "),n("ul",t._l(t.info.prize,function(e,r){return n("li",{key:r},[n("span",{staticClass:"tal"},[t._v(t._s(e.term_name))]),t._v(" "),n("span",[t._v(t._s(e.prize_name))]),t._v(" "),n("span",{staticClass:"tar"},[t._v(t._s(e.num))])])}))]),t._v(" "),n("div",{staticClass:"prize-title mt20"},[n("img",{attrs:{src:t.$BASEIMGPATH+"prize_title.png"}}),t._v(" "),n("span",[t._v("活动时间")])]),t._v(" "),n("p",{staticClass:"time"},[t._v(t._s(t._f("formatDate")(t.info.start_time,"s"))+" ~ "+t._s(t._f("formatDate")(t.info.end_time,"s")))]),t._v(" "),t.info.desc?n("div",{staticClass:"prize-title"},[n("img",{attrs:{src:t.$BASEIMGPATH+"prize_title.png"}}),t._v(" "),n("span",[t._v("活动说明")])]):t._e(),t._v(" "),t.info.desc?n("p",{staticClass:"time"},[t._v(t._s(t.info.desc))]):t._e()]),t._v(" "),n("div",{staticClass:"explain-bottom"},[n("img",{staticClass:"pic-arcs",attrs:{src:t.$BASEIMGPATH+"arcs.png"}}),t._v(" "),n("div",{staticClass:"bottom-wrap"},[n("van-button",{attrs:{type:"danger",size:"small"},nativeOn:{click:function(e){return t.close(e)}}},[t._v("知道了")])],1)])])]):t._e()},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("ul",{staticClass:"table-th"},[e("li",[e("span",{staticClass:"tal"},[this._v("奖项")]),this._v(" "),e("span",[this._v("奖品名称")]),this._v(" "),e("span",{staticClass:"tar"},[this._v("数量")])])])}]};var d=n("VU/8")(u,h,!1,function(t){n("9Yn1")},"data-v-39a6b622",null).exports,v={data:function(){return{listData:[],params:{page_index:1,page_size:50},nowTime:null,copyHtml:null}},watch:{},filters:{telvague:function(t){return t?t.substr(0,3)+"****"+t.substr(7):"匿名"}},mounted:function(){this.loadData()},methods:{loadData:function(){var t,e=this;e.params.scratch_card_id=e.$route.params.scratchcardid?e.$route.params.scratchcardid:null,(t=e.params,Object(l.a)({url:"/addons/scratchcard/scratchcard/prizeRecords",method:"post",data:t})).then(function(t){e.listData=t.data.data,e.moveTop()})},closeInterval:function(){clearInterval(this.nowTime),this.nowTime=null},moveTop:function(){var t=this;if(this.listData.length<=6)return!1;this.copyHtml=this.listData;var e=this.$refs.prize;this.nowTime=setInterval(function(){e.scrollTop-t.$refs.prizeFirstUl.scrollHeight<=0?e.scrollTop++:e.scrollTop=0},50)}}},f={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticClass:"prize-wrap"},[n("h3",{staticClass:"prize-title"},[t._v("幸运刮刮卡中奖记录")]),t._v(" "),n("div",{ref:"prize",staticClass:"prize-list-wrap"},[n("ul",{ref:"prizeFirstUl",staticClass:"item"},t._l(t.listData,function(e,r){return n("li",{key:r},[n("span",{staticClass:"title"},[t._v(t._s(t._f("telvague")(e.user_tel)))]),t._v(" "),n("span",{staticClass:"date"},[t._v(t._s(e.term_name))])])})),t._v(" "),n("ul",t._l(t.copyHtml,function(e,r){return n("li",{key:r},[n("span",{staticClass:"title"},[t._v(t._s(t._f("telvague")(e.user_tel)))]),t._v(" "),n("span",{staticClass:"date"},[t._v(t._s(e.term_name))])])}))])])])},staticRenderFns:[]};var p=n("VU/8")(v,f,!1,function(t){n("Jb41")},"data-v-307a2346",null).exports,m=n("1nCk"),_=n("r5Ok"),y=n("+7rM"),g=n("R5/C"),x={data:function(){return{events:[],startMoveHandler:null,moveHandler:null,endMoveHandler:null,isContinue:!0,noPrize:!1,winPrize:!1,isShare:!1}},props:{handCallback:{type:Function,default:function(){}},frequency:{type:[Number,String],default:0},activity:{type:[Boolean],default:!1},prizeCode:[Number,String],prizename:{type:String,default:""},termname:{type:String,default:""}},methods:{init:function(){if(this.isSupportCanvas()){var t=document.querySelector("#scratchWrap");this.canvas=t.querySelector("#canvas"),this.ctx=this.canvas.getContext("2d"),this.canvas.width=t.clientWidth,this.canvas.height=t.clientHeight,this.createCanvasStyle(),this.bindEvent()}else this.$refs.load.fail("当前浏览器不支持canvas")},isSupportCanvas:function(){var t=document.createElement("canvas");return!(!t.getContext||!t.getContext("2d"))},createCanvasStyle:function(){this.ctx.fillStyle="#cfd4d5",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.font="20px bold sans-serif",this.ctx.fillStyle="#333",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText("刮一刮",this.canvas.width/2,60)},bindEvent:function(){this.events=["touchstart","touchmove","touchend"],this.addEvent()},addEvent:function(){this.num=0,this.pos=0,this.isContinue&&(this.startMoveHandler=this.startEventHandler.bind(this),this.canvas.addEventListener(this.events[0],this.startMoveHandler,!1))},startEventHandler:function(t){if(t.preventDefault(),0===this.frequency)return this.$Toast("抱歉，您已经没有抽奖机会了。"),!1;this.moveHandler=this.moveEventHandler.bind(this),this.endMoveHandler=this.endEventHandler.bind(this),this.canvas.addEventListener(this.events[1],this.moveHandler,!1),document.addEventListener(this.events[2],this.endMoveHandler,!1)},moveEventHandler:function(t){t.preventDefault(),t=t.touches[0];var e=this.canvas.getBoundingClientRect(),n=document.documentElement.scrollTop||document.body.scrollTop,r=document.documentElement.scrollLeft||document.body.scrollLeft,i=t.pageX-e.left-r,a=t.pageY-e.top-n;if(this.ctx.beginPath(),this.ctx.fillStyle="#FFFFFF",this.ctx.globalCompositeOperation="destination-out",this.num++,this.pos+=Math.abs(i+a),1===this.num&&1==this.isContinue&&this.handCallback(),0!==this.prizeCode&&1!==this.prizeCode)return!1;this.ctx.arc(i,a,15,0,2*Math.PI),this.ctx.fill()},endEventHandler:function(t){var e=this;t.preventDefault(),this.canvas.removeEventListener(this.events[1],this.moveHandler,!1),document.removeEventListener(this.events[2],this.endMoveHandler,!1),this.endMoveHandler=null,setTimeout(function(){e.caleArea()},100)},caleArea:function(){if(0!==this.prizeCode&&1!==this.prizeCode)return!1;this.pos>=3e3&&1==this.isContinue&&(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.canvas.removeEventListener(this.events[0],this.startMoveHandler),this.canvas.removeEventListener(this.events[1],this.moveHandler,!1),document.removeEventListener(this.events[2],this.endMoveHandler,!1),0==this.prizeCode?this.noPrize=!0:1==this.prizeCode&&(this.winPrize=!0),this.isContinue=!1,this.num=0,this.pos=0)},onContinue:function(){this.isContinue=!0,this.init()},closeToast:function(){1==this.activity?(this.activity=!1,window.history.length<=1?this.$router.replace("/"):this.$router.go(-1)):1==this.noPrize?this.noPrize=!1:1==this.winPrize&&(this.winPrize=!1)},closeShare:function(){this.isShare=!1},openShare:function(){this.winPrize=!1,this.noPrize=!1,this.$store.state.isWeixin?this.isShare=!0:this.$Toast("请点击下方工具栏“分享”按钮进行分享")}},components:{PopupActivityEnd:m.a,PopupNoPrize:_.a,PopupWinPrize:y.a,PopupShare:g.a}},w={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticClass:"scratchcard-main"},[n("div",{staticClass:"scratchcard-main-wrap"},[t._m(0),t._v(" "),n("div",{staticClass:"scratchcard-main-box",attrs:{id:"scratchWrap"}},[n("span",[t._v(t._s(t.termname))]),t._v(" "),n("canvas",{attrs:{id:"canvas",height:"120"}})]),t._v(" "),t._m(1)])]),t._v(" "),-9999!==t.frequency?n("p",{staticClass:"scratchcard-chance"},[t._v("\n    剩余抽奖次数：\n    "),n("span",[t._v(t._s(t.frequency))]),t._v("次\n  ")]):t._e(),t._v(" "),n("div",{staticClass:"btn-continue"},[n("van-button",{attrs:{type:"default",disabled:t.isContinue},on:{click:t.onContinue}},[t._v("再刮一次")])],1),t._v(" "),n("PopupActivityEnd",{attrs:{isShow:t.activity},on:{close:t.closeToast}}),t._v(" "),n("PopupWinPrize",{attrs:{isShow:t.winPrize,termname:t.termname,prizename:t.prizename},on:{close:t.closeToast,share:t.openShare}}),t._v(" "),n("PopupNoPrize",{attrs:{isShow:t.noPrize},on:{close:t.closeToast,share:t.openShare}}),t._v(" "),n("PopupShare",{attrs:{isShow:t.isShare},nativeOn:{click:function(e){return t.closeShare(e)}}})],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li"),this._v(" "),e("li"),this._v(" "),e("li"),this._v(" "),e("li"),this._v(" "),e("li")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li"),this._v(" "),e("li"),this._v(" "),e("li"),this._v(" "),e("li"),this._v(" "),e("li")])}]};var C=n("VU/8")(x,w,!1,function(t){n("r+4c")},"data-v-1b28608a",null).exports,b=Object(o.a)({name:"scratchcard-centre",data:function(){return{navtitle:"",scratchcardid:null,isExplain:!1,frequency:0,activity:!1,termname:null,prizename:null,prizeCode:null}},computed:{navbarTitle:function(){var t="幸运刮刮乐";return this.navtitle&&(t=this.navtitle),t&&(document.title=t),t}},mounted:function(){var t,e=this;if(this.$store.state.config.addons.scratchcard){if(!this.$route.params.scratchcardid)return;this.scratchcardid=this.$route.params.scratchcardid,this.$refs.load.success(),(t=this.scratchcardid,Object(l.a)({url:"/addons/scratchcard/scratchcard/userFrequency",method:"post",data:{scratch_card_id:t},isWriteIn:!0})).then(function(t){var n=t.data;e.navtitle=n.scratchcard_name,1==n.state?(e.$refs.load.result(),e.$Toast("活动还未开始"),e.$router.replace("/member/centre")):2==n.state?(e.frequency=n.frequency,e.$refs.scard.init()):3==n.state&&(e.activity=!0,e.$refs.scard.init())}).catch(function(){e.$refs.load.fail()})}else this.$refs.load.fail({errorText:"未开启刮刮乐应用",showFoot:!1})},beforeDestroy:function(){this.$refs.situation.closeInterval()},methods:{closeExplain:function(){this.isExplain=!1},openExplain:function(){this.isExplain=!0},handCallback:function(){var t=this;return s()(i.a.mark(function e(){var n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.termname="",t.prizename="",e.prev=2,e.next=5,(r=t.scratchcardid,Object(l.a)({url:"/addons/scratchcard/scratchcard/userScratchcard",method:"post",data:{scratch_card_id:r},isWriteIn:!0})).then();case 5:return n=e.sent,e.next=8,n.code;case 8:t.prizeCode=e.sent,0==n.code?(t.termname=n.message,-9999!==t.frequency&&(t.frequency=t.frequency-1)):1==n.code&&(t.termname=n.data.term_name,t.prizename=n.data.prize_name,-9999!==t.frequency&&(t.frequency=t.frequency-1)),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),console.log(e.t0);case 15:case"end":return e.stop()}var r},e,t,[[2,12]])}))()}},components:{HeadBanner:c.a,Explain:d,PrizeList:p,Card:C}}),E={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("Layout",{ref:"load",staticClass:"scratchcard-centre bg-f6"},[n("Navbar",{attrs:{title:t.navbarTitle}}),t._v(" "),n("HeadBanner",{attrs:{src:t.$BASEIMGPATH+"scratchcard-bg.png"}}),t._v(" "),n("div",{staticClass:"right-tag"},[n("div",{staticClass:"menu",on:{click:t.openExplain}},[t._v("活动说明")]),t._v(" "),n("router-link",{staticClass:"menu",attrs:{to:"/prize/list"}},[t._v("我的奖品")])],1),t._v(" "),n("Card",{ref:"scard",attrs:{handCallback:t.handCallback,frequency:t.frequency,activity:t.activity,termname:t.termname,prizename:t.prizename,prizeCode:t.prizeCode}}),t._v(" "),n("PrizeList",{ref:"situation"}),t._v(" "),n("Explain",{attrs:{isShow:t.isExplain,id:t.scratchcardid},on:{close:t.closeExplain}})],1)},staticRenderFns:[]};var z=n("VU/8")(b,E,!1,function(t){n("s0qp")},"data-v-de296a22",null);e.default=z.exports}});